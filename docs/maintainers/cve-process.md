# CVE Handling Process

This document describes the end-to-end process for handling security vulnerabilities in ModelAudit.
For user-facing policy, see [`SECURITY.md`](../../SECURITY.md).

## 1. Intake Channels

| Channel                                | Action                                                         |
| -------------------------------------- | -------------------------------------------------------------- |
| Email to `security@promptfoo.dev`      | Primary channel; acknowledge within 48 hours                   |
| GitHub Private Vulnerability Reporting | Converts to draft advisory; acknowledge within 48 hours        |
| Dependabot alert                       | Assign to a maintainer; triage within 1 business day           |
| CodeQL / GHAS alert                    | Review immediately; escalate if exploitable in scanner context |

All confirmed vulnerabilities must end up as a draft GitHub Security Advisory before any fix work begins. Do not discuss details in public issues or PRs.

## 2. Triage

**Severity (CVSS v3.1)**

| CVSS Score | Severity | Target fix window  |
| ---------- | -------- | ------------------ |
| 9.0–10.0   | Critical | 30 days            |
| 7.0–8.9    | High     | 30–60 days         |
| 4.0–6.9    | Medium   | Next release cycle |
| 0.1–3.9    | Low      | Best effort        |

**ModelAudit-specific impact factors**

- Does it bypass a malicious-model detection (pickle, safetensors, ONNX, etc.)? Treat as at least High.
- Does it allow arbitrary code execution when scanning a crafted model file? Treat as Critical.
- Does it expose secrets or credentials found during scanning? Treat as High.
- Is the vulnerable code only reachable via an optional dependency that is not installed by default? May reduce severity one tier.

**Out of scope** (per `SECURITY.md`): third-party dependency CVEs not reachable through ModelAudit's own code paths, the promptfoo.dev website, and model files themselves.

## 3. Fix Workflow

1. **Draft advisory** — Open a GitHub Security Advisory in draft. Record CVSS score, affected versions, and reproduction steps.
2. **Private branch** — Create a fix branch from the latest release tag. Use GitHub's advisory-linked private fork when the reporter needs to collaborate.
   - Branch naming: `fix/ghsa-<id>` or `security/cve-<year>-<id>`
3. **Implementation** — Apply the minimum-scope fix. Do not bundle unrelated changes.
4. **Testing requirements**
   - Unit test that exercises the exact vulnerable path.
   - Regression test using the reporter's PoC or an equivalent crafted artifact.
   - Full CI suite must pass: `uv run ruff format`, `uv run ruff check`, `uv run mypy`, `uv run pytest -n auto -m "not slow and not integration"`.
5. **Review** — At least one maintainer review on the private branch before merging.
6. **Backports** — Only the latest release line is supported (see `SECURITY.md`). No backports to older versions.

## 4. Disclosure Timeline

| Milestone                       | Target                                                  |
| ------------------------------- | ------------------------------------------------------- |
| Acknowledgment to reporter      | 48 hours from receipt                                   |
| Initial severity assessment     | 5 business days                                         |
| Fix complete and tested         | Within fix window (see §2)                              |
| Coordinated disclosure date set | Agreed with reporter; default 30 days for Critical/High |
| Public release + advisory       | Simultaneously                                          |

If a fix requires longer than the default window, communicate proactively with the reporter and agree on an extension. Do not delay publication indefinitely.

## 5. Publication

When the fix is ready for release:

1. **Merge** the private branch into `main` via a normal PR (no security details in PR description until disclosure day).
2. **Release** — Push the release tag. release-please handles version bump and PyPI publish automatically.
3. **Publish advisory** — On disclosure day, publish the GitHub Security Advisory. Include:
   - CVE ID (request one via GitHub if not already assigned)
   - Affected versions and patched version
   - CVSS score and vector string
   - Description of the vulnerability and its impact on model scanning
   - Credit to the reporter (unless anonymity requested)
4. **CHANGELOG** — Ensure the release's `### Security` section references the advisory (e.g., `fix: prevent arbitrary code execution via crafted pickle file (GHSA-xxxx-xxxx-xxxx)`).
5. **Notify reporter** — Send the advisory URL and thank them.

## 6. Post-Incident Review

Within 2 weeks of publication, hold a brief retrospective. Document in a private internal note or issue:

- Root cause and why it was not caught earlier.
- Whether detection logic needs hardening across similar code paths.
- Whether the response timeline was met and what caused any delays.
- Any process improvements (new tests, CodeQL queries, documentation updates).

Assign follow-up issues for structural improvements identified in the review.
